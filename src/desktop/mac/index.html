<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>@@app</title>

    <meta name="robots" content="index, follow" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="@@app" />
    <meta name="author" content="@@author">

    <link rel="stylesheet" href="fonts/flaticon.css"/>
    <link rel="stylesheet" href="@@app.css"/>
  </head>
  <body>
    <span id="app-loading">loading...</span>
    <div id="app-container"></div>

    <input style="display:none;" id="fileOpen" type="file" />
    <input style="display:none;" id="fileSave" type="file" nwsaveas="untitled.pixels" />

    <script src="@@app.js"></script>

    <script>

      function clickInput(id) {
        var event = document.createEvent('MouseEvents');
        event.initMouseEvent('click');
        document.getElementById(id).dispatchEvent(event);
      }


      var gui = require('nw.gui');
      var win = gui.Window.get();
      var windowMenu = new gui.Menu({ type: "menubar" });

      windowMenu.createMacBuiltin("@@app", {
        hideEdit: true,
        hideWindow: true
      });
      win.menu = windowMenu;

      var fileMenu = new gui.Menu();
      win.menu.insert(new gui.MenuItem({label: 'File', submenu: fileMenu}), 1);

      fileMenu.insert(new gui.MenuItem({
        label: 'Save As',
        click: function() {
          alert('Save As');
        }
      }));

      fileMenu.insert(new gui.MenuItem({
        label: 'Save',
        click: function() {
          clickInput('fileSave');
        },
        key: 's',
        modifiers: 'cmd'
      }));

      fileMenu.insert(new gui.MenuItem({
        label: 'Open',
        click: function() {
          clickInput('fileOpen');
        },
        key: 'o',
        modifiers: 'cmd'
      }));


      document.getElementById('fileOpen').addEventListener('change', function (e) {
        File.load(this.value, fileLoaded);
      });

      document.getElementById('fileSave').addEventListener('change', function (e) {
        file.save(this.value);
      });

    </script>
  </body>
</html>